<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>接口文档</title>
    <link href="css/spetre.min.css" rel="stylesheet">
    <link href="css/spectre-icons.min.css" rel="stylesheet">
    <style>
        .ng-cloak{display:none;}
    </style>
</head>
<body ng-app="app" ng-cloak class="ng-cloak">
<div class="container" ng-controller="indexController">
    <div class="columns">
        <div class="column col-4 col-auto">
            <ul class="nav">
                <li class="nav-item">
                    <h3>{{apiDocument.title}}</h3>
                    <div>{{apiDocument.date | date:'yyyy-MM-dd HH:mm:ss Z'}}</div>
                    <div>
                        <span class="label label-success" ng-show="canAccess">服务可用</span>
                        <span class="label label-error" ng-show="!canAccess">服务不可用</span>
                        <button class="btn btn-primary btn-sm" ng-class="{true:'loading',false:''}[isLoading]" ng-click="refreshAccessState();"><i class="icon icon-refresh"></i></button>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="form-group">
                        <input class="form-input" type="text" ng-model="searchText" placeholder="要查询的API">
                    </div>
                </li>
                <li class="nav-item" ng-click="showHistory();">
                    <a class="c-hand">文档首页</a>
                </li>
                <li class="nav-item" ng-click="showHeaderModal();">
                    <a class="c-hand">全局头部</a>
                </li>
                <li class="nav-item" ng-show="lastUsed.length>0">
                    <span>最近使用</span>
                    <ul class="nav">
                        <li class="nav-item" ng-repeat="api in lastUsed">
                            <a class="c-hand">
                                <s ng-show="api.deprecated" ng-click="setCurrentAPI(api);">{{api.name}}</s>
                                <span ng-show="!api.deprecated" ng-click="setCurrentAPI(api);">{{api.name}}</span>
                            </a>
                        </li>
                        <li class="nav-item" ng-show="lastUsed.length>0">
                            <a class="c-hand">
                                <div class="divider"></div>
                                <span ng-click="cleanHistory();">清除历史记录</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item" ng-show="searchText==null||''==searchText">
                    <span>实体类信息</span>
                    <ul class="nav">
                        <li class="nav-item" ng-repeat="(key,val) in apiDocument.apiEntityMap">
                            <a class="c-hand">
                                <span ng-click="setCurrentEntity(val);">{{val.simpleName}}({{val.description}})</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item" ng-repeat="apiController in apiControllerList" ng-show="showApiController(apiController);">
                    <s ng-show="apiController.deprecated">{{apiController.name}}
                        <span class="label label-primary px-2">{{apiController.apiList.length}}</span>
                    </s>
                    <span ng-show="!apiController.deprecated">{{apiController.name}}
                        <span class="label label-primary px-2">{{apiController.apiList.length}}</span>
                    </span>
                    <ul class="nav">
                        <li class="nav-item" ng-repeat="api in apiController.apiList" ng-show="showApi(api);">
                            <a class="c-hand">
                                <i class="icon icon-check" ng-show="api.ok" ng-click="toggleAPIState(api);"></i>
                                <i class="icon icon-minus" ng-hide="api.ok" ng-click="toggleAPIState(api);"></i>
                                <s ng-show="api.deprecated" ng-click="setCurrentAPI(api);" style="color:{{api.ok?'green':''}}">{{api.name}}</s>
                                <span ng-show="!api.deprecated" ng-click="setCurrentAPI(api);" style="color:{{api.ok?'green':''}}">{{api.name}}</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="column col-8" ng-show="currentEntity==null&&currentAPI==null">
            <div class="timeline">
                <div class="timeline-item" ng-repeat="apiHistory in apiDocument.apiHistoryList">
                    <div class="timeline-left">
                        <a class="timeline-icon icon-lg">
                            <i class="timeline-icon tooltip"></i>
                        </a>
                    </div>
                    <div class="timeline-content">
                        <div class="tile">
                            <div class="tile-content">
                                <p class="tile-subtitle">
                                    <h3>{{apiHistory.updateTime | date:'yyyy-MM-dd HH:mm:ss'}}</h3>
                                </p>
                                <p class="tile-title" ng-repeat="api in apiHistory.addList"><span class="label label-primary">新增</span>{{api.methods[0]}}&nbsp;&nbsp;{{api.url}}<button class="btn btn-sm" ng-click="setCurrentAPI(api);">{{api.name}}</button></p>
                                <p class="tile-title" ng-repeat="api in apiHistory.modifyList"><span class="label label-warning">变更</span>{{api.methods[0]}}&nbsp;&nbsp;{{api.url}}<button class="btn btn-sm" ng-click="setCurrentAPI(api);">{{api.name}}</button></p>
                                <p class="tile-title" ng-repeat="api in apiHistory.deleteList"><span class="label label-error">删除</span>{{api.methods[0]}}&nbsp;&nbsp;{{api.url}}<button class="btn btn-sm" ng-click="setCurrentAPI(api);">{{api.name}}</button></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="column col-8" ng-show="currentEntity!=null">
            <entity-table entity="currentEntity"></entity-table>
        </div>
        <div class="column col-8" ng-show="currentAPI!=null" id="top">
            <h3 class="m-2" ng-show="currentAPI.deprecated">
                <s>{{currentAPI.name}}</s>
                <div class="toast toast-warning m-2">
                    请注意:该接口已被废弃!
                </div>
            </h3>
            <h3 ng-show="!currentAPI.deprecated">
                <span>{{currentAPI.name}}</span>
            </h3>
            <div class="columns">
                <div class="column col-auto col-1">
                    <span class="label label-primary px-2" ng-repeat="method in currentAPI.methods">{{method}}</span>
                </div>
                <div class="column col-11">
                    <h6>{{currentAPI.url}}</h6>
                </div>
            </div>
            <div class="columns">
                <p ng-bind-html="currentAPI.description"></p>
            </div>
            <div class="columns">
                <div class="col-12">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">
                                <h3>请求参数</h3>
                            </div>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>参数名</th>
                                    <th>参数类型</th>
                                    <th>参数请求类型</th>
                                    <th>描述</th>
                                    <th>是否必须</th>
                                    <th>默认值</th>
                                    <th>参数值</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-show="currentAPI.apiParameters==null||currentAPI.apiParameters.length==0">
                                    <td colspan="7" class="text-center">当前请求不需要传递参数</td>
                                </tr>
                                <tr ng-repeat="apiParameter in currentAPI.apiParameters">
                                    <td>{{apiParameter.name}}</td>
                                    <td>{{apiParameter.type}}</td>
                                    <td>{{apiParameter.requestType}}</td>
                                    <td>{{apiParameter.description}}</td>
                                    <td ng-class="{true:'',false:'text-gray'}[apiParameter.required]">
                                        {{apiParameter.required}}
                                    </td>
                                    <td>{{apiParameter.defaultValue}}</td>
                                    <td ng-switch="apiParameter.requestType">
                                        <input class="form-input" ng-switch-when="text" type="text" ng-model="request[apiParameter.name]">
                                        <input class="form-input" ng-switch-when="file" type="file" id="{{apiParameter.name}}" ng-model="request[apiParameter.name]">
                                        <textarea ng-switch-when="textarea" class="form-input" ng-model="request[apiParameter.name]" rows="10" cols="15"></textarea>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="panel">
                        <div class="panel-body">
                            <entity-table entity="apiDocument.apiEntityMap[parameterEntityName]" ng-repeat="parameterEntityName in currentAPI.parameterEntityNameList"></entity-table>
                        </div>
                    </div>
                </div>
                <div class="col-12" ng-show="currentAPI.apiExceptions.length>0">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">
                                <h3>抛出异常</h3>
                            </div>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>抛出异常</th>
                                    <th>说明</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="apiException in currentAPI.apiExceptions">
                                    <td>{{apiException.className}}</td>
                                    <td>{{apiException.description}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">
                                <h3>返回值</h3>
                            </div>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>类名</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>{{currentAPI.returnValue}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="col col-12">
                    <button class="btn btn-primary m-2" ng-click="execute();">执行请求</button>
                    <div class="loading loading-lg" ng-show="loading"></div>
                </div>
                <div class="divider"></div>
                <div class="col-12" ng-show="response!=null">
                    <div class="column col-auto col-1">
                        <span class="label label-success px-2" ng-show="response.status<400||response.status>500">{{response.status}}</span>
                        <span class="label label-error px-2" ng-show="response.status>=400&&response.status<600">{{response.status}}</span>
                    </div>
                    <div class="column col-11">
                        <h5>{{response.statusText}}</h5>
                    </div>
                </div>
                <div class="col-12" ng-show="response!=null">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">
                                <h3>返回头部</h3>
                            </div>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>头部</th>
                                    <th>值</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="(key,val) in response.config.headers">
                                    <td>{{key}}</td>
                                    <td>{{val}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-12 bg-gray" ng-show="response!=null">
                    <pre>{{responseJSON}}</pre>
                </div>
                <entity-table entity="apiDocument.apiEntityMap[returnEntityName]" ng-repeat="returnEntityName in currentAPI.returnEntityNameList"></entity-table>
            </div>
        </div>
    </div>
</div>
<div class="modal active" ng-show="showHeader">
    <a class="modal-overlay" aria-label="Close" ng-click="hideHeaderModal();"></a>
    <div class="modal-container">
        <div class="modal-header">
            <a class="btn btn-clear float-right" aria-label="Close" ng-click="hideHeaderModal();"></a>
            <div class="modal-title h5">全局头部</div>
        </div>
        <div class="modal-body">
            <div class="content">
                <table class="table">
                    <tbody>
                    <tr ng-repeat="(key,val) in headers">
                        <td>
                            <input class="form-input" type="text" ng-model="key" placeholder="name">
                        </td>
                        <td>
                            <input class="form-input" type="text" ng-model="val" placeholder="value">
                        </td>
                        <td>
                            <i class="icon icon-minus c-hand" ng-click="removeHeader(key);"></i>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input class="form-input" type="text" ng-model="addKey" placeholder="name">
                        </td>
                        <td>
                            <input class="form-input" type="text" ng-model="addValue" placeholder="value">
                        </td>
                        <td>
                            <i class="icon icon-plus c-hand" ng-click="addHeader();"></i>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
<script src="js/angular.min.js"></script>
<script src="js/angular-sanitize.min.js"></script>
<script src="index.js"></script>
</html>
